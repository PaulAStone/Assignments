---
title: "Week 2 Exercise"
author: "Z620: Quantitative Biodiversity, Indiana University"
date: "November 8, 2014"
output: pdf_document
---

## Overview

In this exercise, we will use R and RStudio to explore aspects of local (alpha) diversity using the tropical forest dataset from Barro-Colorado Island (BCI), a 1,560-hectare island in the center of the Panama Canal that is administered by the Smithsonian. After setting up our working environment, we will explore the BCI dataset and ways to quantify and examine the alpha-diversity within individual plots of tropical trees.

## RETRIEVE AND SET YOUR WORKING DIRECTORY

```{r, echo=FALSE}
getwd()
setwd("~/GitHub/Quantitative_Biodiversity/Assignments/Week2")
```

## INSTALL PACKAGES

Ecologists have developed many packages for conducting quantitative analyses using R. You can use the 'help' function to learn more about package installation and add-ons. We will often use the package called 'vegan', which contains tools commonly used in ecological research, including analyses of alpha-diversity. To install vegan into your R environment type: install.packages("vegan") into your RStudio console.

```{r}
require("vegan") #You can also type: library("vegan"). The difference being that "require"
#loads additional packages (dependencies) that vegan requires for some analyses.
```

Conveniently, the vegan library contains a version of the BCI dataset, which is obtained by censusing the trees of 50 1-hectare plots. More information on this data can be found here: http://ctfs.arnarb.harvard.edu/webatlas/datasets/bci/.

```{r}
data(BCI) # Loading the BCI dataset
```

In vegan, the BCI data are organized into a site-by-species matrix, that is, a data table where the abundances of all 225 tree species (columns) are given for each site (rows), to include absences. Consequently, this table should have 50 rows and 225 columns. Let's verify this using the dimension or "dim" function:

```{r}
dim(BCI)  # Prints the dimensions of the site (row) by species (column) matrix
```

The **site-by-species matrix** is one of the most basic data structures used by ecologists. With the BCI site-by-species matrix loaded, let's print the abundances of 4 species found in the first 8 sites.

```{r}
BCI[1:8, 14:17]	# print abundances for sites (rows) 1 to 8 and for species (columns) 14 to 17
```

Here, we can see that Cabbage Bark (*Andira inermis*) is absent from six of the eight sites and is only found as a single individual in two sites. On ther other hand, *Apeiba aspera* (locally known as Monkey Comb) is found at all eight sites and is relatively much more abundant than any of the other three species that we selected.




So far, you have been introduced to an important data structure, the site-by-species matrix. You have learned to print its dimensions and to print the abundances of particular species (columns) found in specific sites (rows). Now, let's focus on a specific site by selecting the first row and assigning it to a variable called "Site1":

```{r}
Site1 = BCI[1,] # assign the first row (site) to the variable Site1
dim(Site1) # print the dimensions of Site1 to the screen 
```

You can see that Site1 has one row (only 1 site) and 225 columns. But note that the BCI site-by-species matrix also accounts for absences with zeros. That is, while there are 225 columns 




Calculate Shannon index. 'Margin = 1' means diversity is calculated row-wise; 'Margin = 2' means diversity is calcualted column-wise.With base = exp(1), we are esimating Shannon's index using the natural logrithm of each taxon's relative abundance using the equation; $H' = -{\sum ( p_{i} \times ln(p_{i}))}$

```{r}
shannon <- diversity(BCI, index="shannon", MARGIN = 1, base=exp(1))
```

Can also calculate other diversity metrics

```{r}
simpson <- diversity(BCI, "simpson")
invsimpson <- diversity(BCI, "inv")
fisher <- fisher.alpha(BCI)
``` 

Let's plot ***Pairs is not a normal plotting tool, introduce first***

```{r}
pairs(cbind(shannon, simpson, invsimpson, fisher), pch="+", col="blue")
```

Species richness

```{r}
S <- specnumber(BCI)
```

Rarefaction

```{r}
(raremax <- min(rowSums(BCI)))
Srare <- rarefy(BCI, raremax)
plot(S, Srare, xlab = "Observed No. of Species", ylab = "Rarefied No. of Species")
abline(0, 1)
rarecurve(BCI, step = 20, sample = raremax, col = "blue", cex = 0.6)
```

Example: http://www.jennajacobs.org/R/rarefaction.html

Calculating relative abundances
```{r}
BCI_t <- t(BCI)

BCIrel <- BCI_t
for(i in 1:ncol(BCI_t)){
  BCIrel[,i] = BCI_t[,i] / sum(BCI_t[,i])
  }
```

What's one way to test that this worked?
```{r}
colSums(BCIrel)
```

Now let's create a rank abundance curve. First, let's rank taxa within a sample (site 1) by relative abundance

```{r}
rad <- BCIrel[order(BCIrel[,1], decreasing=TRUE), ]
head(rad)
```

Let's make a ranking now that species abundances are ordered/sorted 

```{r}
ranks <- seq(1,nrow(rad))
```

Let's create RAD plot

```{r}
plot(ranks,rad[,1],type='l',col="black",xlab="Rank",lwd=8,ylab="Relative Abundance",xlim=range(ranks))
```



