---
title: "Phylogenetic Diversity - Traits"
author: "Z620: Quantitative Biodiversity, Indiana University"
date: "February 20, 2015"
header-includes:
   - \usepackage{array}
output: pdf_document
geometry: margin=2.54cm
---

## OVERVIEW

## 1) SETUP
### A. Retrieve and Set Your Working Directory

```{r, results = 'hide'}
rm(list = ls())
getwd()
setwd("~/GitHub/QuantitativeBiodiversity/Assignments/PhyloTraits")
```

### B. Load Packages 
```{r, results = 'hide', message = FALSE, warning = FALSE} 
require("muscle")
require("ape")
require("seqinr")
```

## 2) DESCRIPTION OF DATA
The meintenance of biodiversity is thought to be influenced by trade-offs among species. 
One such trade-off involves species that are highly specialized at using a single resource. 
However, this may come at the cost of not being able to use other resoruces as well.
We set out to test this hypothesized trade-off in bacteria by assessing generalist and specialist strategies on different forms of phopshorus, which commonly limits growth and reproduction of populations in freshwater ecosystems.
More..

## 3) SEQUENCE ALIGNMENT
It appears that DNA sequences can be alligned in R using at least two packages: `ape` and `muscle`. 
In `ape`, alignments can be done with the functions `clustal`, `muscle`, and `tcoffee`, all which seem to have a range of options. 
However, it seem that these functions call on other installed programs, like ClustalX. 
In contrast, the `muscle` package aligns sequences in a "stand alone" fashion. 

```{r}
seq.aln <- muscle::muscle(seqs="p.isolates.fasta", out = "p.isolates.aln.fasta") 
```

## 4) VISUALIZE THE ALIGNMENT
```{r}
read.aln <- read.alignment(file = "p.isolates.aln.fasta", format = "fasta") # seqinr command to read muscle align

p.DNAbin <- as.DNAbin(read.aln) # ape command to convert fasta file into DNAbin filetype

x <- p.DNAbin[,400:500] # identify region (in bp of 16S rRNA) to visuzlize

image(x, cex.lab = 0.5) # ape command to visusalize seq align

grid(ncol(x),nrow(x),col="lightgrey") # ape command to add grid
```

## 5) CREATE AND EVALUATE EVOLUTIONARY MODELS
```{r}
seq.dist <- dist.dna(p.DNAbin, model = "K80", pairwise.deletion = TRUE) # ape command for Evo model: Kimuraâ€™s 2-parameters distance

nj.tree <- nj(seq.dist) # ape command for Neighbor Joining

plot.phylo(nj.tree, type="phylogram", use.edge.length = FALSE, direction = "right", cex = 0.5, label.offset = 1) # ape command
```

## 6) MAXIMUM LIKELIHOOD ESTIMATION AND BOOTSTRAP SUPPORT
**We may need to use the package `phangorn` (http://cran.r-project.org/web/packages/phangorn/phangorn.pdf)**
** Discussed by Paradis (2012) on pp 138-159

## 7) MAPPING TRAITS ONTO TREES
** Discussed by Paradis (2012), chapter 4
** Basically, want to get to the point where people can visusalize singe or multiple traits mapped onto brances of trees
** Could do this with Kali's P isoltes or with Lennon et al. (2010) with soil isolates and traits. 

## 8) PHYLOGENETIC SIGNAL
**Phylogenetic signal is outlined in Paradis (2012) on pp 236-239
**Can we take a big-picture look at the phylogeny and traits combined and deteremine whether or not their is "signal" beyond null Brownian motion?
Hopefully, we pick an example where the answer is "yes"

## 9) PHYLOGENETIC INDEPENDENT CONTRASTS
**Phylogenetic independent contrasts are outlined in Paradis (2012) on pp 204-209
**Can we take a trait-peformance relationship that's siginficant and correct for phylogeny? 
Is the relationship still significant? 
Do the parameters or explained varition change?

